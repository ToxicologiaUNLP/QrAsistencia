<!DOCTYPE html>
<html lang="es-AR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Laboratorio Central</title>
<link rel="icon" type="image/png" href="logolab.png">
<style>
:root{
  --bg:#61adc1;
  --text:#002b36;
  --muted:#275b67;
  --card:#ffffff;
  --shade: rgba(0,0,0,.08);
}
*{box-sizing:border-box;}
body{
  margin:0; font-family: Arial, Helvetica, sans-serif;
  background: var(--bg); color: var(--text);
}
header{
  background: var(--card);
  padding: 24px 16px;
  text-align:center;
  box-shadow: 0 2px 12px var(--shade);
}
header img{
  display:block; margin:0 auto 10px;
  max-width: 220px; width: 125%;
}
header h1{
  margin: 6px 0 4px; font-size: 28px; color: #003d4d;
}
header h2{
  margin:0; font-weight: normal; color: #0b6a7f;
  font-size: 16px;
}
main{
  max-width: 1280px;
  margin: 28px auto; padding: 24px;
  background: var(--card); border-radius: 14px;
  box-shadow: 0 6px 24px var(--shade);
  position: relative;
}
.status{
  margin-bottom: 12px; padding: 10px 12px; border-radius: 8px;
  font-size: 14px;
  background: #eef6ff; border:1px solid #cfe8ff; color:#0b4a6d;
  transition: opacity 0.6s ease;
}
.status.ok{ background:#eefaf1; border-color:#cfeedd; color:#205b3a;}
.status.err{ background:#fff2f2; border-color:#ffd0d0; color:#7a1c1c;}
.search-wrap{ position: relative; margin-bottom:12px; }
#searchLabel{
  display:block;
  font-weight:bold;
  color:#0b6a7f;
  margin-bottom:6px;
  font-size:16px;
}
#searchBox{
  width:100%; padding:12px 14px; font-size:16px;
  border:1px solid #cfd8dc; border-radius:10px; outline:none;
}
#searchBox:focus{ border-color:#7ab8c6; box-shadow: 0 0 0 3px rgba(122,184,198,.25); }
#suggestions{
  position: absolute; left:0; right:0; top: calc(100% + 6px);
  background: #fff; border:1px solid #dfe7ea; border-radius: 10px;
  box-shadow: 0 10px 24px rgba(0,0,0,.08);
  max-height: 300px; overflow-y: auto; display:none; z-index: 20;
}
.suggestion{
  padding: 10px 12px; cursor: pointer;
  border-bottom: 1px solid #f1f3f5;
}
.suggestion:last-child{ border-bottom: 0; }
.suggestion:hover{ background:#f5fbfd; }
.suggestion.selected{ background: #d0f0f8; }
.details{
  margin-top: 18px;
  overflow-x: auto;
}
table{
  border-collapse: collapse;
  table-layout: auto;
  width: max-content;
  min-width: 100%;
}
th, td{
  border: 1px solid #333;
  padding: 6px 10px;
  text-align: left;
  vertical-align: top;
  white-space: nowrap;
}
td{
  white-space: pre-wrap;
}
td:nth-child(4),
th:nth-child(4){
  white-space: pre-wrap;
}

/* Botón PDF */
.pdf-btn{
  display:inline-block;
  margin-top:4px;
  padding:6px 12px;
  font-size:14px;
  font-weight:bold;
  text-decoration:none;
  color:#fff;
  background:#0b6a7f;
  border:none;
  cursor:pointer;
  border-radius:6px;
  box-shadow:0 2px 6px var(--shade);
  transition: background 0.2s, transform 0.1s;
}
.pdf-btn:hover{ background:#095866; }
.pdf-btn:active{ transform: scale(0.97); }

/* Modal visor PDF */
#pdfModal{
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.8);
  display:none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
#pdfModal iframe{
  width:90%;
  height:90%;
  border:none;
  border-radius:10px;
  box-shadow:0 4px 20px rgba(0,0,0,.5);
  background:#fff;
}
#pdfModal .close-btn{
  position:absolute;
  top:20px;
  right:30px;
  font-size:28px;
  font-weight:bold;
  color:#fff;
  cursor:pointer;
}
#pdfModal .close-btn:hover{ color:#ddd; }

/* Botón contacto */
.contact-btn{
  display:block;
  margin:20px auto 0;
  padding:10px 22px;
  font-size:16px;
  font-weight:bold;
  text-decoration:none;
  color:#fff;
  background:#0b6a7f;
  border:none;
  cursor:pointer;
  border-radius:8px;
  box-shadow:0 3px 8px var(--shade);
  transition: background 0.2s, transform 0.1s;
}
.contact-btn:hover{ background:#095866; }
.contact-btn:active{ transform:scale(0.97); }

/* Modal contacto */
#contactModal{
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.8);
  display:none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
#contactModal .modal-content{
  background:#ffffff;
  padding:30px;
  border-radius:14px;
  max-width:600px;
  width:90%;
  max-height:80%;
  overflow-y:auto;
  text-align:center;
  color:#003d4d;
  box-shadow:0 4px 24px rgba(0,0,0,.4);
  font-family: Arial, Helvetica, sans-serif;
}
.contact-area{
  margin-bottom:16px;
}
.contact-area h3{
  margin:0 0 6px;
  font-size:20px;
  color:#0b6a7f;
  font-weight:bold;
}
.contact-area p{
  margin:3px 0;
  font-size:15px;
  line-height:1.5;
  color:#000;
}
.contact-area a{
  color:#000;
  text-decoration:none;
}
.contact-area a:hover{ text-decoration:underline; }
/* Close modal */
#contactModal .close-btn{
  position:absolute;
  top:10px; 
  right:15px; 
  font-size:28px;
  font-weight:bold;
  color:#fff;
  cursor:pointer;
  z-index:10;
}
#contactModal .close-btn:hover{ color:#ddd; }
</style>
</head>
<body>
<header>
  <img src="logolab.png" alt="Logo del Laboratorio">
  <h1>Laboratorio Central</h1>
  <h2>Valores de referencia y condiciones en la toma de muestra</h2>
</header>
<main>
  <div id="status" class="status">Cargando datos…</div>
  <div class="search-wrap">
    <label id="searchLabel" for="searchBox">Buscador:</label>
    <input id="searchBox" type="text" placeholder="Escriba el procedimiento de interés aquí" autocomplete="off" />
    <div id="suggestions"></div>
  </div>
  <div id="result" class="details"></div>

  <button class="contact-btn" id="openContact">Contacto</button>
</main>

<!-- Modal PDF -->
<div id="pdfModal">
  <span class="close-btn">&times;</span>
  <iframe src=""></iframe>
</div>

<!-- Modal Contacto -->
<div id="contactModal">
  <span class="close-btn" id="closeContact">&times;</span>
  <div class="modal-content">
    <div class="contact-area">
      <h3>ADMISIÓN</h3>
      <p>Internos: 1706 / 1754 / 1714</p>
    </div>
    <div class="contact-area">
      <h3>ENDOCRINOLOGÍA</h3>
      <p>Interno: 1732</p>
      <p><a href="mailto:labendocrinoludovica@gmail.com">labendocrinoludovica@gmail.com</a></p>
    </div>
    <div class="contact-area">
      <h3>HEMATOLOGÍA / HEMOSTASIA</h3>
      <p>Internos: 1717 / 1733</p>
      <p><a href="mailto:labhemato.ludovica@gmail.com">labhemato.ludovica@gmail.com</a></p>
    </div>
    <div class="contact-area">
      <h3>GUARDIA</h3>
      <p>Interno: 1715</p>
      <p><a href="mailto:guardialabludovica@gmail.com">guardialabludovica@gmail.com</a></p>
    </div>
    <div class="contact-area">
      <h3>INMUNOLOGÍA</h3>
      <p>Internos: 1728 / 1729</p>
      <p><a href="mailto:inmunoserologia.lab@gmail.com">inmunoserologia.lab@gmail.com</a></p>
    </div>
    <div class="contact-area">
      <h3>MEDIO INTERNO</h3>
      <p>Interno: 1716</p>
      <p><a href="mailto:mediointernoludovica@gmail.com">mediointernoludovica@gmail.com</a></p>
    </div>
    <div class="contact-area">
      <h3>METABOLOPATÍAS</h3>
      <p>Interno: 1733</p>
      <p><a href="mailto:labmetabolo@gmail.com">labmetabolo@gmail.com</a></p>
    </div>
    <div class="contact-area">
      <h3>PARASITOLOGÍA</h3>
      <p>Interno: 1730</p>
      <p><a href="mailto:coproparasitologialudovica@gmail.com">coproparasitologialudovica@gmail.com</a></p>
    </div>
    <div class="contact-area">
      <h3>QUÍMICA</h3>
      <p>Interno: 1722</p>
    </div>
    <div class="contact-area">
      <h3>TOXICOLOGÍA</h3>
      <p>Interno: 1731</p>
      <p><a href="mailto:labtoxicologia.ludovica@gmail.com">labtoxicologia.ludovica@gmail.com</a></p>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
// CSV y búsqueda
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT_1_DpeDPmqZOjSmtIGeb8Ri-yuGtWz7sWwwFMdyWssacb5RTdJkpu_7OBPi_yPw/pub?output=csv";
function getNoCacheUrl(){ return CSV_URL + "&t=" + Date.now(); }
const statusEl = document.getElementById('status');
const inputEl = document.getElementById('searchBox');
const sugEl = document.getElementById('suggestions');
const resultDiv = document.getElementById('result');
const pdfModal = document.getElementById('pdfModal');
const pdfFrame = pdfModal.querySelector('iframe');
const pdfClose = pdfModal.querySelector('.close-btn');

let rows = [], headers = [], studyKey = null, selectedIndex=-1;
const normHeader = h => (h||"").toString().replace(/\r/g,'').trim();
const normText = t => (t||"").toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();

function loadData(){
  Papa.parse(getNoCacheUrl(), {
    download:true, header:true, skipEmptyLines:true, dynamicTyping:false,
    complete: function(res){
      try{
        headers = (res.meta.fields||Object.keys(res.data[0]||{})).map(normHeader)
                  .filter(h=>h!=="" && !/^_?\d+$/.test(h));
        rows = res.data.map(obj=>{
          const clean={};
          for(const [k,v] of Object.entries(obj)){
            const nk = normHeader(k);
            if(headers.includes(nk)) clean[nk] = (v==null?"":String(v).replace(/\r/g,'').trim());
          }
          return clean;
        }).filter(r=>Object.keys(r).length>0);
        studyKey = headers.find(h=>normHeader(h).toUpperCase()==="ESTUDIO") 
                 || headers.find(h=>normHeader(h).toUpperCase()==="ESTUDIOS");
        if(!rows.length) throw new Error("El CSV no contiene filas de datos.");
        if(!studyKey) throw new Error('No se encontró la columna "ESTUDIO" en el CSV.');
        statusEl.textContent = `Datos cargados: ${rows.length} estudios.`;
        statusEl.className = "status ok";
        setTimeout(()=>{ statusEl.style.opacity='0'; },5000);
      }catch(err){
        statusEl.textContent = err.message;
        statusEl.className = "status err";
      }
    },
    error: function(err){
      statusEl.textContent = "Error al cargar el CSV: "+err;
      statusEl.className = "status err";
    }
  });
}
loadData();

// búsqueda
inputEl.addEventListener('input', ()=>{
  const q = normText(inputEl.value); sugEl.innerHTML=""; selectedIndex=-1;
  if(!q || !rows.length || !studyKey){ sugEl.style.display="none"; resultDiv.innerHTML=""; return; }
  const matches = rows.filter(r=>normText(r[studyKey]).includes(q)).slice(0,50);
  if(!matches.length){ sugEl.style.display="none"; resultDiv.innerHTML=""; return; }
  sugEl.style.display="block";
  matches.slice(0,12).forEach(r=>{
    const div = document.createElement('div'); div.className='suggestion';
    div.textContent = r[studyKey]; div.onclick=()=>showTable(r); sugEl.appendChild(div);
  });
});
inputEl.addEventListener('keydown', (e)=>{
  const items = sugEl.querySelectorAll('.suggestion'); if(items.length===0) return;
  if(e.key==='ArrowDown'){ e.preventDefault(); selectedIndex=(selectedIndex+1)%items.length; updateSelection(items);}
  else if(e.key==='ArrowUp'){ e.preventDefault(); selectedIndex=(selectedIndex-1+items.length)%items.length; updateSelection(items);}
  else if(e.key==='Enter'){ e.preventDefault(); if(selectedIndex>=0 && selectedIndex<items.length){items[selectedIndex].click(); selectedIndex=-1;} else if(items.length>0){items[0].click();} }
});
function updateSelection(items){ items.forEach((el,i)=>{ if(i===selectedIndex){el.classList.add('selected'); el.scrollIntoView({block:'nearest'});} else{el.classList.remove('selected');} });}
function openPdf(url){ pdfFrame.src=url; pdfModal.style.display="flex"; }
function showTable(row){
  sugEl.style.display="none"; inputEl.value=row[studyKey]||"";
  const tbodyHtml = `<tr>${headers.map(h=>{
    const cell=row[normHeader(h)]||'';
    if(cell.toLowerCase().includes('.pdf') || cell.toLowerCase().includes('drive.google.com')){
      let embedUrl = cell;
      const match = cell.match(/\/d\/([a-zA-Z0-9_-]+)\//);
      if(match) embedUrl=`https://drive.google.com/file/d/${match[1]}/preview`;
      return `<td><button class="pdf-btn" onclick="openPdf('${embedUrl}')">Ver valores</button></td>`;
    } else { return `<td>${cell}</td>`; }
  }).join('')}</tr>`;
  resultDiv.innerHTML = `<table><thead><tr>${headers.map(h=>`<th>${h}</th>`).join('')}</tr></thead><tbody>${tbodyHtml}</tbody></table>`;
}
pdfClose.addEventListener('click', ()=>{ pdfModal.style.display="none"; pdfFrame.src=""; });
pdfModal.addEventListener('click',(e)=>{ if(e.target===pdfModal){ pdfModal.style.display="none"; pdfFrame.src=""; } });

// Modal Contacto funcional
const contactModal = document.getElementById('contactModal');
const openContact = document.getElementById('openContact');
const closeContact = document.getElementById('closeContact');
openContact.addEventListener('click', ()=>{ contactModal.style.display='flex'; });
closeContact.addEventListener('click', ()=>{ contactModal.style.display='none'; });
contactModal.addEventListener('click',(e)=>{ if(e.target===contactModal) contactModal.style.display='none'; });

setInterval(loadData,30000);
</script>
</body>
</html>








