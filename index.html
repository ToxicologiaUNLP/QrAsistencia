<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Estudios</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #results { margin-top: 20px; }
    .item { padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; border-radius: 5px; cursor: pointer; }
    .details { display: none; padding: 10px; background: #f9f9f9; border-top: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Buscador de Estudios</h1>
  <input type="text" id="search" placeholder="EscribÃ­ el estudio...">
  <div id="results"></div>

  <script>
    let data = [];
    let headers = [];

    async function loadCSV() {
      try {
        const response = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vT_1_DpeDPmqZOjSmtIGeb8Ri-yuGtWz7sWwwFMdyWssacb5RTdJkpu_7OBPi_yPw/pub?output=csv");
        const csvText = await response.text();
        console.log("CSV cargado:", csvText.slice(0, 200)); // ðŸ‘ˆ mostramos las primeras 200 letras

        const rows = csvText.split("\n").map(r => r.split(","));
        headers = rows[0];
        data = rows.slice(1);
        console.log("Encabezados:", headers);
        console.log("Ejemplo de fila:", data[0]);

      } catch (err) {
        console.error("Error cargando CSV:", err);
      }
    }

    function renderResults(results) {
      const container = document.getElementById("results");
      container.innerHTML = "";
      results.forEach(row => {
        const item = document.createElement("div");
        item.className = "item";
        item.textContent = row[0]; // ðŸ‘ˆ Columna 1 = Estudio

        const details = document.createElement("div");
        details.className = "details";
        details.innerHTML = headers.map((h, i) => `<b>${h}:</b> ${row[i] || ""}`).join("<br>");

        item.onclick = () => {
          details.style.display = details.style.display === "none" ? "block" : "none";
        };

        item.appendChild(details);
        container.appendChild(item);
      });
    }

    document.getElementById("search").addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      const filtered = data.filter(r => r[0] && r[0].toLowerCase().includes(term));
      renderResults(filtered);
    });

    loadCSV();
  </script>
</body>
</html>
